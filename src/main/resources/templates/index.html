<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n l√Ω sinh vi√™n</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px 0;
        }
        .main-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            padding: 30px;
            margin-top: 20px;
        }
        .header-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        .header-section h2 {
            margin: 0;
            font-weight: 700;
            font-size: 2rem;
        }
        .search-box {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 25px;
        }
        .search-box input {
            border-radius: 25px;
            padding: 12px 20px;
            border: 2px solid #e0e0e0;
            transition: all 0.3s;
        }
        .search-box input:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
        }
        .table-container {
            overflow-x: auto;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        .table {
            margin-bottom: 0;
        }
        .table thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .table thead th {
            border: none;
            padding: 15px;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.85rem;
            letter-spacing: 0.5px;
        }
        .table tbody tr {
            transition: all 0.3s;
        }
        .table tbody tr:hover {
            background-color: #f8f9fa;
            transform: scale(1.01);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .table tbody td {
            vertical-align: middle;
            padding: 15px;
        }
        .form-section {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            padding: 25px;
            border-radius: 15px;
            margin-top: 30px;
            box-shadow: 0 5px 15px rgba(245, 87, 108, 0.3);
        }
        .form-section h4 {
            color: white;
            font-weight: 600;
            margin-bottom: 20px;
        }
        .form-section input {
            border-radius: 10px;
            padding: 12px 15px;
            border: none;
            background: white;
        }
        .btn {
            border-radius: 25px;
            padding: 10px 25px;
            font-weight: 600;
            transition: all 0.3s;
            border: none;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .btn-action {
            margin: 0 3px;
            padding: 6px 12px;
        }
        .badge-id {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-weight: 600;
        }
    </style>
</head>
<body>
<div class="container">
    <div class="main-container">
        <div class="header-section">
            <h2><i class="fas fa-graduation-cap"></i> QU·∫¢N L√ù SINH VI√äN</h2>
        </div>

        <div class="search-box">
            <div class="row g-3">
                <div class="col-md-6">
                    <div class="input-group">
                        <span class="input-group-text bg-white border-0"><i class="fas fa-search"></i></span>
                        <input type="text" id="searchName" class="form-control border-start-0"
                               placeholder="üîç T√¨m theo t√™n..." onkeyup="searchStudent()">
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="input-group">
                        <span class="input-group-text bg-white border-0"><i class="fas fa-hashtag"></i></span>
                        <input type="number" id="searchId" class="form-control border-start-0"
                               placeholder="üîç T√¨m theo ID..." onkeyup="searchById()">
                    </div>
                </div>
            </div>
        </div>

        <div class="table-container">
            <table class="table table-hover">
                <thead>
                <tr>
                    <th><i class="fas fa-id-badge"></i> ID</th>
                    <th><i class="fas fa-user"></i> T√™n</th>
                    <th><i class="fas fa-birthday-cake"></i> Tu·ªïi</th>
                    <th><i class="fas fa-envelope"></i> Email</th>
                    <th class="text-center"><i class="fas fa-cog"></i> H√†nh ƒë·ªông</th>
                </tr>
                </thead>
                <tbody id="studentTable"></tbody>
            </table>
        </div>

        <div class="form-section">
            <h4 id="formTitle"><i class="fas fa-user-plus"></i> Th√™m sinh vi√™n</h4>
            <input type="hidden" id="studentId">
            <div class="mb-3">
                <input id="name" class="form-control" placeholder="üìù T√™n sinh vi√™n">
            </div>
            <div class="mb-3">
                <input id="age" type="number" class="form-control" placeholder="üéÇ Tu·ªïi">
            </div>
            <div class="mb-3">
                <input id="email" class="form-control" placeholder="üìß Email">
            </div>
            <button id="submitBtn" class="btn btn-light me-2" onclick="saveStudent()">
                <i class="fas fa-plus-circle"></i> Th√™m
            </button>
            <button id="cancelBtn" class="btn btn-outline-light" onclick="cancelEdit()" style="display:none;">
                <i class="fas fa-times-circle"></i> H·ªßy
            </button>
        </div>
    </div>
</div>

<script>
const API = "https://lab3-production-1572.up.railway.app/api/students";

function loadStudents() {
    fetch(API)
        .then(res => res.json())
        .then(data => {
            let html = "";
            data.forEach(s => {
                html += `
                <tr>
                    <td><span class="badge-id">${s.id}</span></td>
                    <td><strong>${s.name}</strong></td>
                    <td><i class="fas fa-user-clock text-primary"></i> ${s.age || 'N/A'}</td>
                    <td><i class="fas fa-envelope text-info"></i> ${s.email}</td>
                    <td class="text-center">
                        <button class="btn btn-warning btn-sm btn-action" title="S·ª≠a"
                            onclick="editStudent(${s.id}, '${s.name}', ${s.age}, '${s.email}')">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-danger btn-sm btn-action" title="X√≥a"
                            onclick="deleteStudent(${s.id})">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                    </td>
                </tr>`;
            });
            document.getElementById("studentTable").innerHTML = html || 
                '<tr><td colspan="5" class="text-center text-muted">Ch∆∞a c√≥ sinh vi√™n n√†o</td></tr>';
        });
}

function saveStudent() {
    const id = document.getElementById("studentId").value;
    const student = {
        name: document.getElementById("name").value,
        age: parseInt(document.getElementById("age").value),
        email: document.getElementById("email").value
    };

    const url = id ? `${API}/update/${id}` : API;
    const method = "POST";

    fetch(url, {
        method: method,
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(student)
    }).then(() => {
        resetForm();
        loadStudents();
    });
}

function editStudent(id, name, age, email) {
    document.getElementById("studentId").value = id;
    document.getElementById("name").value = name;
    document.getElementById("age").value = age;
    document.getElementById("email").value = email;
    document.getElementById("formTitle").innerHTML = '<i class="fas fa-user-edit"></i> C·∫≠p nh·∫≠t sinh vi√™n';
    document.getElementById("submitBtn").innerHTML = '<i class="fas fa-save"></i> C·∫≠p nh·∫≠t';
    document.getElementById("submitBtn").className = "btn btn-success me-2";
    document.getElementById("cancelBtn").style.display = "inline-block";
    
    // Scroll to form
    document.querySelector('.form-section').scrollIntoView({ behavior: 'smooth' });
}

function cancelEdit() {
    resetForm();
}

function resetForm() {
    document.getElementById("studentId").value = "";
    document.getElementById("name").value = "";
    document.getElementById("age").value = "";
    document.getElementById("email").value = "";
    document.getElementById("formTitle").innerHTML = '<i class="fas fa-user-plus"></i> Th√™m sinh vi√™n';
    document.getElementById("submitBtn").innerHTML = '<i class="fas fa-plus-circle"></i> Th√™m';
    document.getElementById("submitBtn").className = "btn btn-light me-2";
    document.getElementById("cancelBtn").style.display = "none";
}

function deleteStudent(id) {
    if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a sinh vi√™n n√†y?')) {
        fetch(`${API}/${id}`, { method: "DELETE" })
            .then(() => {
                loadStudents();
                showNotification('ƒê√£ x√≥a sinh vi√™n th√†nh c√¥ng!', 'success');
            });
    }
}

function showNotification(message, type) {
    // Simple notification (you can enhance this)
    const alertDiv = document.createElement('div');
    alertDiv.className = `alert alert-${type} position-fixed top-0 start-50 translate-middle-x mt-3`;
    alertDiv.style.zIndex = '9999';
    alertDiv.textContent = message;
    document.body.appendChild(alertDiv);
    setTimeout(() => alertDiv.remove(), 3000);
}

function searchStudent() {
    const name = document.getElementById("searchName").value;
    document.getElementById("searchId").value = ""; // Clear ID search
    
    if (!name) {
        loadStudents();
        return;
    }
    
    fetch(`${API}/search?name=${name}`)
        .then(res => res.json())
        .then(data => {
            displaySearchResults(data);
        });
}

function searchById() {
    const id = document.getElementById("searchId").value;
    document.getElementById("searchName").value = ""; // Clear name search
    
    if (!id) {
        loadStudents();
        return;
    }
    
    fetch(`${API}/${id}`)
        .then(res => res.json())
        .then(data => {
            if (data && data.id) {
                displaySearchResults([data]);
            } else {
                document.getElementById("studentTable").innerHTML = 
                    '<tr><td colspan="5" class="text-center text-muted"><i class="fas fa-search"></i> Kh√¥ng t√¨m th·∫•y sinh vi√™n</td></tr>';
            }
        })
        .catch(() => {
            document.getElementById("studentTable").innerHTML = 
                '<tr><td colspan="5" class="text-center text-muted"><i class="fas fa-exclamation-circle"></i> Kh√¥ng t√¨m th·∫•y sinh vi√™n</td></tr>';
        });
}

function displaySearchResults(data) {
    let html = "";
    data.forEach(s => {
        html += `
        <tr>
            <td><span class="badge-id">${s.id}</span></td>
            <td><strong>${s.name}</strong></td>
            <td><i class="fas fa-user-clock text-primary"></i> ${s.age || 'N/A'}</td>
            <td><i class="fas fa-envelope text-info"></i> ${s.email}</td>
            <td class="text-center">
                <button class="btn btn-warning btn-sm btn-action" title="S·ª≠a"
                    onclick="editStudent(${s.id}, '${s.name}', ${s.age}, '${s.email}')">
                    <i class="fas fa-edit"></i>
                </button>
                <button class="btn btn-danger btn-sm btn-action" title="X√≥a"
                    onclick="deleteStudent(${s.id})">
                    <i class="fas fa-trash-alt"></i>
                </button>
            </td>
        </tr>`;
    });
    document.getElementById("studentTable").innerHTML = html || 
        '<tr><td colspan="5" class="text-center text-muted"><i class="fas fa-search"></i> Kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£</td></tr>';
}

loadStudents();
</script>

</body>
</html>
